# å­¦ä¹ ç¬”è®° 2.3 - å‘½ä»¤ç³»ç»Ÿï¼ˆæ‰‹æŠŠæ‰‹æ•™ç¨‹ï¼‰

## ğŸ“– æœ¬èŠ‚ç›®æ ‡

å­¦ä¹ å¦‚ä½•è®¾è®¡å’Œå®ç°ä¸€ä¸ªå¯æ‰©å±•çš„å‘½ä»¤ç³»ç»Ÿï¼Œæ”¯æŒï¼š
1. **å‘½ä»¤è§£æ**ï¼šè¯†åˆ«ç”¨æˆ·è¾“å…¥çš„æ˜¯èŠå¤©å†…å®¹è¿˜æ˜¯å‘½ä»¤ï¼ˆå¦‚ `/help`ï¼‰
2. **å‘½ä»¤æ³¨å†Œ**ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰å¯ç”¨å‘½ä»¤
3. **å‘½ä»¤æ‰§è¡Œ**ï¼šæ‰§è¡Œå¯¹åº”çš„å‘½ä»¤é€»è¾‘

**å­¦ä¹ æ–¹å¼**ï¼šä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªå‘½ä»¤ç®¡ç†å™¨ã€‚

---

## ğŸ¯ ç»ƒä¹  1ï¼šå®šä¹‰å‘½ä»¤æ¥å£

### ğŸ“ éœ€æ±‚åˆ†æ

æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†æ¥å®šä¹‰å‘½ä»¤ï¼Œæ¯ä¸ªå‘½ä»¤åº”è¯¥åŒ…å«ï¼š
- `name`: å‘½ä»¤åç§°ï¼ˆå¦‚ `help`ï¼‰
- `description`: å‘½ä»¤æè¿°ï¼ˆç”¨äºæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ï¼‰
- `run`: æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°

### ğŸ“‚ ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå‘½ä»¤ç›®å½•

**åœ¨å“ªé‡Œåš**ï¼šé¡¹ç›®æ ¹ç›®å½•

**æ‰§è¡Œå‘½ä»¤**ï¼š
```bash
mkdir -p packages/cli/src/commands
```

---

### ğŸ“„ ç¬¬äºŒæ­¥ï¼šå®šä¹‰å‘½ä»¤ç±»å‹

**åœ¨å“ªé‡Œåš**ï¼š`packages/cli/src/commands/types.ts`

**ä»£ç **ï¼š
```typescript
// packages/cli/src/commands/types.ts

export interface Command {
    name: string;
    description: string;
    run: (args: string[]) => void | Promise<void>;
}                           
```

**åç«¯ç±»æ¯”**ï¼š
```java
// ç±»ä¼¼äº Java æ¥å£
public interface Command {
    String getName();
    String getDescription();
    void run(String[] args);
}
```

---

## ğŸ¯ ç»ƒä¹  2ï¼šå®ç°åŸºç¡€å‘½ä»¤

### ğŸ“ éœ€æ±‚åˆ†æ

æˆ‘ä»¬è¦å®ç°ä¸¤ä¸ªåŸºç¡€å‘½ä»¤ï¼š
1. `/help`: æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤
2. `/exit`: é€€å‡ºç¨‹åº

### ğŸ“„ ç¬¬ä¸€æ­¥ï¼šå®ç° Help å‘½ä»¤

**åœ¨å“ªé‡Œåš**ï¼š`packages/cli/src/commands/HelpCommand.ts`

**ä»£ç **ï¼š
```typescript
import { Command } from './types.js';

export const HelpCommand: Command = {
    name: 'help',
    description: 'æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯',
    run: () => {
        console.log('\nå¯ç”¨å‘½ä»¤åˆ—è¡¨:');
        console.log('  /help    - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯');
        console.log('  /exit    - é€€å‡ºç¨‹åº');
        console.log('  /clear   - æ¸…ç©ºå±å¹•');
    }
};
```

### ğŸ“„ ç¬¬äºŒæ­¥ï¼šå®ç° Exit å‘½ä»¤

**åœ¨å“ªé‡Œåš**ï¼š`packages/cli/src/commands/ExitCommand.ts`

**ä»£ç **ï¼š
```typescript
import { Command } from './types.js';

export const ExitCommand: Command = {
    name: 'exit',
    description: 'é€€å‡ºç¨‹åº',
    run: () => {
        console.log('å†è§ï¼ğŸ‘‹');
        process.exit(0);
    }
};
```

---

## ğŸ¯ ç»ƒä¹  3ï¼šæ„å»ºå‘½ä»¤ç®¡ç†å™¨

### ğŸ“ éœ€æ±‚åˆ†æ

æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸­å¿ƒåŒ–çš„ç®¡ç†å™¨æ¥ï¼š
1. æ³¨å†Œæ‰€æœ‰å‘½ä»¤
2. è§£æç”¨æˆ·è¾“å…¥
3. æŸ¥æ‰¾å¹¶æ‰§è¡ŒåŒ¹é…çš„å‘½ä»¤

### ğŸ“„ ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå‘½ä»¤ç®¡ç†å™¨

**åœ¨å“ªé‡Œåš**ï¼š`packages/cli/src/commands/CommandManager.ts`

**ä»£ç **ï¼š
```typescript
import { Command } from './types.js';
import { HelpCommand } from './HelpCommand.js';
import { ExitCommand } from './ExitCommand.js';

class CommandManager {
    private commands: Map<string, Command> = new Map();

    constructor() {
        // æ³¨å†ŒåŸºç¡€å‘½ä»¤
        this.register(HelpCommand);
        this.register(ExitCommand);
    }

    // æ³¨å†Œå‘½ä»¤
    register(command: Command) {
        this.commands.set(command.name, command);
    }

    // è§£æå¹¶æ‰§è¡Œè¾“å…¥
    // è¿”å›å€¼: true è¡¨ç¤ºæ‰§è¡Œäº†å‘½ä»¤ï¼Œfalse è¡¨ç¤ºæ˜¯æ™®é€šæ–‡æœ¬
    async handleInput(input: string): Promise<boolean> {
        // 1. æ£€æŸ¥æ˜¯å¦æ˜¯å‘½ä»¤ï¼ˆä»¥ / å¼€å¤´ï¼‰
        if (!input.startsWith('/')) {
            return false;
        }

        // 2. è§£æå‘½ä»¤åå’Œå‚æ•°
        // ä¾‹å¦‚: "/echo hello world" -> name="echo", args=["hello", "world"]
        const parts = input.slice(1).trim().split(/\s+/);
        const commandName = parts[0];
        const args = parts.slice(1);

        // 3. æŸ¥æ‰¾å‘½ä»¤
        const command = this.commands.get(commandName);

        if (!command) {
            console.log(`âŒ æœªçŸ¥å‘½ä»¤: ${commandName}`);
            console.log('è¾“å…¥ /help æŸ¥çœ‹å¯ç”¨å‘½ä»¤');
            return true; // è™½ç„¶æ˜¯æœªçŸ¥å‘½ä»¤ï¼Œä½†ä¹Ÿç®—å¤„ç†äº†å‘½ä»¤
        }

        // 4. æ‰§è¡Œå‘½ä»¤
        try {
            await command.run(args);
        } catch (error) {
            console.error(`æ‰§è¡Œå‘½ä»¤å¤±è´¥: ${error}`);
        }

        return true;
    }
}

// å¯¼å‡ºå•ä¾‹å®ä¾‹
export const commandManager = new CommandManager();
```

**åç«¯ç±»æ¯”**ï¼š
- ç±»ä¼¼äº Spring MVC çš„ `DispatcherServlet`ï¼Œè´Ÿè´£åˆ†å‘è¯·æ±‚ã€‚
- æˆ–è€…å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰çš„ Invokerã€‚

---

## ğŸ¯ ç»ƒä¹  4ï¼šé›†æˆåˆ° UI

### ğŸ“ éœ€æ±‚åˆ†æ

æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¹‹å‰çš„ `index.tsx`ï¼Œæ·»åŠ ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè®©ç”¨æˆ·å¯ä»¥è¾“å…¥å‘½ä»¤ã€‚

### ğŸ“¦ ç¬¬ä¸€æ­¥ï¼šå®‰è£…è¾“å…¥æ¡†ç»„ä»¶

æˆ‘ä»¬éœ€è¦ `ink-text-input` ç»„ä»¶ã€‚

**æ‰§è¡Œå‘½ä»¤**ï¼š
```bash
npm install ink-text-input --workspace packages/cli
```

### ğŸ“„ ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå¸¦è¾“å…¥çš„ App ç»„ä»¶

**åœ¨å“ªé‡Œåš**ï¼š`packages/cli/src/components/InputApp.tsx` (æ–°å»ºæ–‡ä»¶)

**ä»£ç **ï¼š
```tsx
import React, { useState } from 'react';
import { Box, Text, useApp } from 'ink';
import TextInput from 'ink-text-input';
import { commandManager } from '../commands/CommandManager.js';
import { MessageList } from './MessageList.js';

export const InputApp = () => {
    const [input, setInput] = useState('');
    const { exit } = useApp();

    const handleSubmit = async (value: string) => {
        if (!value.trim()) return;

        // å°è¯•ä½œä¸ºå‘½ä»¤å¤„ç†
        const isCommand = await commandManager.handleInput(value);

        if (!isCommand) {
            // å¦‚æœä¸æ˜¯å‘½ä»¤ï¼Œè¿™é‡Œæš‚æ—¶åªæ‰“å°æ—¥å¿—
            // åç»­æˆ‘ä»¬ä¼šåœ¨è¿™é‡Œè°ƒç”¨ AI æ¥å£
            console.log(`\nğŸ‘¤ ç”¨æˆ·è¯´: ${value}`);
        }

        // æ¸…ç©ºè¾“å…¥æ¡†
        setInput('');
    };

    return (
        <Box flexDirection="column" padding={1}>
            <MessageList />
            
            <Box borderStyle="round" borderColor="cyan" paddingX={1}>
                <Text color="green">âœ </Text>
                <TextInput 
                    value={input} 
                    onChange={setInput} 
                    onSubmit={handleSubmit}
                    placeholder="è¾“å…¥æ¶ˆæ¯æˆ– /help..."
                />
            </Box>
        </Box>
    );
};
```

### ğŸ“„ ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°å…¥å£æ–‡ä»¶

**åœ¨å“ªé‡Œåš**ï¼š`packages/cli/src/index.tsx`

**ä»£ç **ï¼š
```tsx
import { render } from 'ink';
import { InputApp } from './components/InputApp.js';

export async function main() {
    render(<InputApp />);
}
```

---

## ğŸš€ è¿è¡Œæµ‹è¯•

1. **æ„å»º**ï¼š`npm run bundle`
2. **è¿è¡Œ**ï¼š`node bundle/cli-demo.js`
3. **æµ‹è¯•**ï¼š
   - è¾“å…¥ `/help` -> åº”è¯¥æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
   - è¾“å…¥ `/exit` -> åº”è¯¥é€€å‡ºç¨‹åº
   - è¾“å…¥ `ä½ å¥½` -> åº”è¯¥æ˜¾ç¤º "ç”¨æˆ·è¯´: ä½ å¥½"

---

## ğŸ“š æœ¬èŠ‚æ€»ç»“

### âœ… ä½ å­¦åˆ°äº†ä»€ä¹ˆ

1. **å‘½ä»¤æ¨¡å¼**ï¼šå¦‚ä½•å°è£…å’Œç®¡ç†å‘½ä»¤
2. **æ–‡æœ¬è§£æ**ï¼šå¦‚ä½•è§£æå‘½ä»¤è¡Œè¾“å…¥
3. **è¾“å…¥ç»„ä»¶**ï¼šä½¿ç”¨ `ink-text-input` å¤„ç†ç”¨æˆ·è¾“å…¥
4. **é›†æˆ**ï¼šå°†å‘½ä»¤ç³»ç»Ÿä¸ UI ç»„ä»¶ç»“åˆ

### ğŸ¯ ä¸‹ä¸€æ­¥

è¿›å…¥ **ç¬¬ä¸‰é˜¶æ®µï¼šAI é›†æˆ**ï¼Œæˆ‘ä»¬å°†å¼€å§‹è°ƒç”¨ Google Gemini APIï¼
