# TypeScript é…ç½®å­¦ä¹ æ€»ç»“

## âœ… å®Œæˆçš„ä»»åŠ¡

### 1. é…ç½®æ–‡ä»¶åˆ›å»º
- âœ… æ ¹ç›®å½• `tsconfig.json` - åŸºç¡€é…ç½®ï¼ˆæ‰€æœ‰åŒ…å…±äº«ï¼‰
- âœ… `packages/core/tsconfig.json` - Core åŒ…é…ç½®
- âœ… `packages/cli/tsconfig.json` - CLI åŒ…é…ç½®ï¼ˆæ”¯æŒ React/JSXï¼‰

### 2. ç¼–è¯‘éªŒè¯
- âœ… æˆåŠŸç¼–è¯‘æ‰€æœ‰åŒ…
- âœ… ç”Ÿæˆå®Œæ•´çš„ç¼–è¯‘äº§ç‰©

---

## ğŸ“ ç¼–è¯‘äº§ç‰©è¯´æ˜

### Core åŒ…ç¼–è¯‘äº§ç‰©
```
packages/core/
â”œâ”€â”€ dist/
â”‚   â”œâ”€â”€ index.js          â† å¯æ‰§è¡Œçš„ JavaScript ä»£ç 
â”‚   â”œâ”€â”€ index.d.ts        â† ç±»å‹å®šä¹‰æ–‡ä»¶ï¼ˆä¾›å…¶ä»–åŒ…ä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ index.js.map      â† Source Mapï¼ˆè°ƒè¯•ç”¨ï¼‰
â”‚   â””â”€â”€ index.d.ts.map    â† ç±»å‹å®šä¹‰çš„ Source Map
â””â”€â”€ tsconfig.tsbuildinfo  â† å¢é‡ç¼–è¯‘ä¿¡æ¯ï¼ˆåŠ å¿«ç¼–è¯‘é€Ÿåº¦ï¼‰
```

### å„æ–‡ä»¶ä½œç”¨
| æ–‡ä»¶ | ä½œç”¨ | ä½•æ—¶ä½¿ç”¨ |
|------|------|----------|
| `index.js` | è¿è¡Œæ—¶æ‰§è¡Œçš„ä»£ç  | Node.js è¿è¡Œæ—¶ |
| `index.d.ts` | ç±»å‹ä¿¡æ¯ | ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ + IDE æ™ºèƒ½æç¤º |
| `index.js.map` | è°ƒè¯•æ˜ å°„ | è°ƒè¯•æ—¶æ˜¾ç¤ºæºä»£ç ä½ç½® |
| `tsconfig.tsbuildinfo` | ç¼–è¯‘ç¼“å­˜ | å¢é‡ç¼–è¯‘ï¼ˆåªç¼–è¯‘ä¿®æ”¹çš„æ–‡ä»¶ï¼‰|

---

## ğŸ” TypeScript é…ç½®è¯¦è§£

### é…ç½®å±‚çº§ç»“æ„

```
æ ¹ç›®å½• tsconfig.json (åŸºç¡€é…ç½®)
    â†“ extends
packages/core/tsconfig.json (ç»§æ‰¿ + Core ç‰¹å®šé…ç½®)
    â†“ extends
packages/cli/tsconfig.json (ç»§æ‰¿ + CLI ç‰¹å®šé…ç½® + å¼•ç”¨ Core)
```

---

## ğŸ“‹ å…³é”®é…ç½®é¡¹åˆ†ç±»

### 1. ä¸¥æ ¼ç±»å‹æ£€æŸ¥ï¼ˆæ¨èå…¨éƒ¨å¼€å¯ï¼‰

```json
{
  "strict": true,                    // å¯ç”¨æ‰€æœ‰ä¸¥æ ¼æ£€æŸ¥
  "noImplicitAny": true,             // ç¦æ­¢éšå¼ any
  "strictNullChecks": true,          // ä¸¥æ ¼çš„ null æ£€æŸ¥
  "noUnusedLocals": true,            // æ£€æµ‹æœªä½¿ç”¨çš„å˜é‡
  "noImplicitReturns": true          // å‡½æ•°å¿…é¡»æœ‰è¿”å›å€¼
}
```

**å¥½å¤„ï¼š**
- ğŸ› ç¼–è¯‘æ—¶å‘ç°æ›´å¤šæ½œåœ¨é”™è¯¯
- ğŸ“ ä»£ç æ›´æ¸…æ™°ï¼Œç±»å‹æ›´æ˜ç¡®
- ğŸ”§ IDE æä¾›æ›´å¥½çš„æ™ºèƒ½æç¤º

---

### 2. æ¨¡å—ç³»ç»Ÿ

```json
{
  "module": "NodeNext",              // Node.js æ¨¡å—ç³»ç»Ÿ
  "moduleResolution": "nodenext",    // æ¨¡å—è§£æç­–ç•¥
  "esModuleInterop": true            // ESM/CommonJS äº’æ“ä½œ
}
```

**ä¸ºä»€ä¹ˆç”¨ NodeNextï¼Ÿ**
- âœ… æ”¯æŒ ESMï¼ˆ`import`/`export`ï¼‰
- âœ… æ”¯æŒ CommonJSï¼ˆ`require`/`module.exports`ï¼‰
- âœ… ç¬¦åˆ Node.js çš„æœ€æ–°æ ‡å‡†

---

### 3. ç¼–è¯‘è¾“å‡º

```json
{
  "outDir": "dist",                  // è¾“å‡ºç›®å½•
  "declaration": true,               // ç”Ÿæˆ .d.ts
  "sourceMap": true,                 // ç”Ÿæˆ .map
  "incremental": true                // å¢é‡ç¼–è¯‘
}
```

**ç¼–è¯‘æµç¨‹ï¼š**
```
src/index.ts
    â†“ TypeScript ç¼–è¯‘å™¨
dist/
â”œâ”€â”€ index.js       (å»é™¤ç±»å‹æ³¨è§£)
â”œâ”€â”€ index.d.ts     (åªä¿ç•™ç±»å‹)
â””â”€â”€ index.js.map   (è°ƒè¯•æ˜ å°„)
```

---

### 4. é¡¹ç›®å¼•ç”¨ï¼ˆMonorepo æ ¸å¿ƒï¼‰

```json
// packages/core/tsconfig.json
{
  "composite": true  // å…è®¸è¢«å…¶ä»–é¡¹ç›®å¼•ç”¨
}

// packages/cli/tsconfig.json
{
  "composite": true,
  "references": [
    { "path": "../core" }  // å¼•ç”¨ core åŒ…
  ]
}
```

**å·¥ä½œåŸç†ï¼š**
1. TypeScript çŸ¥é“ CLI ä¾èµ– Core
2. ç¼–è¯‘ CLI å‰ä¼šå…ˆç¼–è¯‘ Core
3. CLI å¯ä»¥ä½¿ç”¨ Core çš„ç±»å‹å®šä¹‰

**ç±»æ¯” Java Mavenï¼š**
```xml
<dependency>
  <groupId>com.example</groupId>
  <artifactId>core</artifactId>
</dependency>
```

---

### 5. React/JSX æ”¯æŒï¼ˆCLI åŒ…ä¸“ç”¨ï¼‰

```json
{
  "jsx": "react-jsx",                // React 17+ æ–°è½¬æ¢
  "lib": ["DOM", "ES2023"]           // åŒ…å« DOM ç±»å‹
}
```

**JSX è½¬æ¢å¯¹æ¯”ï¼š**

```tsx
// æºä»£ç 
const App = () => <div>Hello</div>;

// jsx: "react" (æ—§æ–¹å¼)
const App = () => React.createElement("div", null, "Hello");

// jsx: "react-jsx" (æ–°æ–¹å¼ï¼Œæ¨è)
import { jsx as _jsx } from "react/jsx-runtime";
const App = () => _jsx("div", { children: "Hello" });
```

**ä¼˜åŠ¿ï¼š**
- âœ… ä¸éœ€è¦åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­ `import React`
- âœ… ç”Ÿæˆçš„ä»£ç æ›´å°
- âœ… æ€§èƒ½æ›´å¥½

---

## ğŸ¯ é…ç½®å¯¹æ¯”ï¼šä½ çš„é¡¹ç›® vs gemini-cli

| é…ç½®é¡¹ | ä½ çš„é¡¹ç›®ï¼ˆç°åœ¨ï¼‰ | gemini-cli | çŠ¶æ€ |
|--------|-----------------|------------|------|
| ä¸¥æ ¼æ£€æŸ¥ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âœ… ä¸€è‡´ |
| æ¨¡å—ç³»ç»Ÿ | âœ… NodeNext | âœ… NodeNext | âœ… ä¸€è‡´ |
| å¢é‡ç¼–è¯‘ | âœ… å¼€å¯ | âœ… å¼€å¯ | âœ… ä¸€è‡´ |
| é¡¹ç›®å¼•ç”¨ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âœ… ä¸€è‡´ |
| JSX æ”¯æŒ | âœ… react-jsx | âœ… react-jsx | âœ… ä¸€è‡´ |

**ç»“è®ºï¼šä½ çš„é…ç½®å·²ç»è¾¾åˆ°ä¸“ä¸šçº§æ°´å¹³ï¼** ğŸ‰

---

## ğŸ”¬ å®éªŒï¼šé…ç½®çš„å½±å“

### å®éªŒ 1ï¼šä¸¥æ ¼ç±»å‹æ£€æŸ¥çš„ä½œç”¨

**å…³é—­ä¸¥æ ¼æ£€æŸ¥ï¼š**
```typescript
// strict: false
function greet(name) {  // âœ… ç¼–è¯‘é€šè¿‡ï¼ˆä½†ä¸å®‰å…¨ï¼‰
  return `Hello, ${name}`;
}
greet(123);  // âœ… ç¼–è¯‘é€šè¿‡ï¼Œä½†è¿è¡Œæ—¶å¯èƒ½å‡ºé”™
```

**å¼€å¯ä¸¥æ ¼æ£€æŸ¥ï¼š**
```typescript
// strict: true
function greet(name) {  // âŒ é”™è¯¯ï¼šå‚æ•°éšå¼å…·æœ‰ any ç±»å‹
  return `Hello, ${name}`;
}

// æ­£ç¡®å†™æ³•
function greet(name: string): string {
  return `Hello, ${name}`;
}
greet(123);  // âŒ é”™è¯¯ï¼šç±»å‹ä¸åŒ¹é…
```

---

### å®éªŒ 2ï¼šå¢é‡ç¼–è¯‘çš„æ•ˆæœ

**ç¬¬ä¸€æ¬¡ç¼–è¯‘ï¼š**
```bash
npm run build
# ç¼–è¯‘æ‰€æœ‰æ–‡ä»¶ï¼Œç”Ÿæˆ tsconfig.tsbuildinfo
```

**ç¬¬äºŒæ¬¡ç¼–è¯‘ï¼ˆæ²¡æœ‰ä¿®æ”¹ï¼‰ï¼š**
```bash
npm run build
# å‡ ä¹ç¬é—´å®Œæˆï¼Œå› ä¸ºè¯»å–äº†ç¼“å­˜
```

**ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶åç¼–è¯‘ï¼š**
```bash
# ä¿®æ”¹ src/index.ts
npm run build
# åªé‡æ–°ç¼–è¯‘ index.tsï¼Œå…¶ä»–æ–‡ä»¶ä½¿ç”¨ç¼“å­˜
```

---

## ğŸ“Š ç¼–è¯‘æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | æ— å¢é‡ç¼–è¯‘ | æœ‰å¢é‡ç¼–è¯‘ | æå‡ |
|------|-----------|-----------|------|
| é¦–æ¬¡ç¼–è¯‘ | 5s | 5s | - |
| æ— ä¿®æ”¹é‡ç¼–è¯‘ | 5s | 0.1s | **50å€** |
| ä¿®æ”¹1ä¸ªæ–‡ä»¶ | 5s | 0.5s | **10å€** |

---

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

```bash
# ç¼–è¯‘æ‰€æœ‰åŒ…
npm run build

# æ¸…ç†ç¼–è¯‘äº§ç‰©
rm -rf packages/*/dist packages/*/*.tsbuildinfo

# é‡æ–°ç¼–è¯‘
npm run build

# åªç¼–è¯‘æŸä¸ªåŒ…
npm run build -w @ai-cli-project/core
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ‰¾ä¸åˆ°ç±»å‹å®šä¹‰æ–‡ä»¶
```
error TS2688: Cannot find type definition file for 'node'.
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
npm install --save-dev @types/node
```

---

### Q2: é¡¹ç›®å¼•ç”¨é”™è¯¯
```
error TS6306: Referenced project must have setting "composite": true.
```

**è§£å†³æ–¹æ¡ˆï¼š**
åœ¨è¢«å¼•ç”¨çš„åŒ…çš„ `tsconfig.json` ä¸­æ·»åŠ ï¼š
```json
{
  "compilerOptions": {
    "composite": true
  }
}
```

---

### Q3: æ¨¡å—è§£æå¤±è´¥
```
error TS2307: Cannot find module '@ai-cli-project/core'
```

**æ£€æŸ¥æ¸…å•ï¼š**
1. âœ… Core åŒ…æ˜¯å¦å·²ç¼–è¯‘ï¼Ÿ
2. âœ… CLI çš„ `package.json` æ˜¯å¦å£°æ˜äº†ä¾èµ–ï¼Ÿ
3. âœ… CLI çš„ `tsconfig.json` æ˜¯å¦æ·»åŠ äº† `references`ï¼Ÿ
4. âœ… æ˜¯å¦è¿è¡Œäº† `npm install`ï¼Ÿ

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

### å®˜æ–¹æ–‡æ¡£
- [TypeScript Handbook](https://www.typescriptlang.org/docs/handbook/intro.html)
- [Project References](https://www.typescriptlang.org/docs/handbook/project-references.html)
- [Compiler Options](https://www.typescriptlang.org/tsconfig)

### æ¨èé…ç½®
- [tsconfig/bases](https://github.com/tsconfig/bases) - å„ç§åœºæ™¯çš„æ¨èé…ç½®

---

## âœ… æ£€æŸ¥ç‚¹

å®Œæˆæœ¬èŠ‚å­¦ä¹ åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [x] ç†è§£ TypeScript é…ç½®çš„å±‚çº§ç»“æ„
- [x] çŸ¥é“å„ä¸ªé…ç½®é¡¹çš„ä½œç”¨
- [x] é…ç½® Monorepo é¡¹ç›®çš„ TypeScript
- [x] ç†è§£é¡¹ç›®å¼•ç”¨ï¼ˆ`composite` å’Œ `references`ï¼‰
- [x] çŸ¥é“å¦‚ä½•ä¼˜åŒ–ç¼–è¯‘æ€§èƒ½ï¼ˆå¢é‡ç¼–è¯‘ï¼‰
- [x] ç†è§£ç¼–è¯‘äº§ç‰©çš„ä½œç”¨

---

## ğŸš€ ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»å®Œæˆäº†ï¼š
- âœ… 1.1 Monorepo æ¶æ„
- âœ… 1.2 TypeScript é…ç½®

**ä¸‹ä¸€æ­¥ï¼š1.3 æ„å»ºç³»ç»Ÿï¼ˆesbuildï¼‰**

å­¦ä¹ å†…å®¹ï¼š
- esbuild çš„ä½¿ç”¨å’Œé…ç½®
- å¦‚ä½•æ‰“åŒ… CLI å·¥å…·
- å¦‚ä½•å¤„ç†èµ„æºæ–‡ä»¶

å‡†å¤‡å¥½äº†å—ï¼ŸğŸ˜Š
